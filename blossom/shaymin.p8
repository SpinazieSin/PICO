pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- main functions --
function _init()
 -- gametime
 gt = 0
 
 -- shaymin variables
 sprite = 16
 sx, sy = 20, 90
 sleeping = true
 sleeping_dir = 1
 left, jump, up, vine = false, false, false, false

	-- flower and branch colors
	flwrcols = {7, 8, 9, 10, 14}
	brnchcols = {3, 11}
	flowers = {}

 --
 scroll_dir = 0
 mid_screen = 63
 camx = 0
 camy = 0
end

function _update()
 if (sx+3)%127 == 0 and sx > 0 then
  if sx > mid_screen then
   sx += 5
   scroll_dir = 2
   mid_screen += 127
  elseif sx < mid_screen then
   sx -= 5
   scroll_dir = -2
   mid_screen -= 127
  end
 end

 -- increment gametime
 if not(scroll_dir == 0) then
  camx += scroll_dir
  camera(camx, camy)
  if camx % 128 == 0 then
   scroll_dir = 0
  end
 else
  gt += 1
 end
 
 -- move shaymin
 move()

 -- falling
 if not(fget(mget((sx+1)/8, (sy+6)/8), 0) or fget(mget((sx+6)/8, (sy+6)/8), 0)) and not(vine or up) then
  sy += 1
  sprite = 3
 elseif not(jump or vine or sleeping) then
  sprite = 1
 end
 
 for flwr in all(flowers) do
 	flwr:update()
 end
end

function _draw()
 cls(12)
 map()
 
 for flwr in all(flowers) do
 	flwr:draw()
 end

 local hmirror = false
 if left and not(sprite > 4 and sprite < 7) then
  hmirror = true
 end
 spr(sprite, sx, sy, 1, 1, hmirror) 
end

-->8
-- movement functions --
function move()
 if sleeping then
  if sprite < 16 then
   sprite = 19
   sleeping_dir = -1
  end

  if sprite == 16 and (btn(4) or btn(5)) then
   sprite += 1
   sleeping_dir = 1
  end

  if sprite > 16 and gt%10 == 0 then
   sprite += sleeping_dir
  end
  
  if sprite == 20 then
   sprite = 1
   sleeping = false
  end
 else
  move_shaymin()
 end
end

function move_shaymin()
 -- gotosleep
 if btn(3) then
  sleeping = true
  jump = false
 end

 -- move left or right
 if btn(0) then 
  left = true
  if vine then
   vine = false
   sprite = 1
  end
 elseif btn(1) then
  left = false
  if vine then
   vine = false
   sprite = 1
  end
 end

 -- climb
 if fget(mget((sx+3)/8, (sy+5)/8), 1) then
  if btn(2) then
   vine = true
   if (sprite < 5) sprite = 5
  end
 else
  vine = false
 end

 -- get input for jump
 if btn(5) and not(jump) then
  jump = true
 end

 -- jump shaymin
 if jump and gt%5 == 0 then
  if vine then
   if gt%10 == 0 then
    sprite += 1
    sy -= 1
    if sprite > 6 then
     sprite = 5
     jump = false
    end
   end
  else
   sprite += 1
   if left then
    if not(fget(mget((sx)/8, (sy+5)/8), 0)) then
     sx -= 1
     add_flower(sx+7, sy+5)
    end
   else
    if not(fget(mget((sx+7)/8, (sy+5)/8), 0)) then
     sx += 1
     add_flower(sx+1, sy+5)
    end
   end
   
   if sprite > 3 then
    sprite = 1
    jump = false
   end
  end
  if btn(5) then
   gt += 1
  end
 end
end

-->8
-- particles --
function add_flower(x, y)
 -- random chance to spawn flower
 if (rnd(100) < 80) return

 local x = x or sx
 local y = y or sy
 local brnch = brnchcols[flr(1+rnd(2))]
 local flwr = flwrcols[flr(1+rnd(5))]
	local life = rnd(40) + 1
 local bloom_size = rnd(2)
	add(flowers, {
		x = x,
		y = y,
		h = 0,
		brnch = brnch,
		flwr = flwr,
		life = life,
  bloom_size = bloom_size,
  bloom = false,
		update = function(self)
			if self.life > 0 then
				self.life -= 1
				self.h += 0.1
			elseif not(self.bloom) then
    self.bloom = true
   end
		end,
		
		draw = function(self)
   line(self.x, self.y, self.x, self.y - self.h, self.brnch)
   if self.bloom then
    circfill(self.x, self.y - self.h, self.bloom_size, self.flwr)
   end
		end
	})
end

__gfx__
000000000000000000bbbb0000bbbb00000000000bbb00000bbb000000000000000000000000000000000000000000000000330000c000000000a00000000000
0000000000bbbb000bbbebb00bbbebb000000000bbbbe000bbbbe0000000f00000000000c500500000000500000000000003b33000cc0000000aaa0000000000
007007000bbbebb00b3efe700b3efe7000bbbb00bbbef000bbbef000555fff5500044000056660000005755000000000003b30000cccc000009aaa0aa0000000
000770000b3efe700773e7700773e7700bbbebb0bbb3e000bbb3e000055fff50004444008677665c0010707500000000303b30030cccc0000a09a999a0000000
000770000773e77070000700007007000b3efeb0bbbb3000bbbb300005fefef0004ee400060766500059977500000000bb33b333cccccc00aa9898899aa00000
007007000700070000000000000000700bb3ebb00bbb00000bbb000000fffff00044440000666058055511510000000003b33330c7c77cc0098a8aa89aa00000
0000000000000000000000000000000000000000000000000707000000fffff00054445000050000155177500000000000111100717177c009a0a0aa90000000
0000000000000000000000000000000000000000000000000000000000f00f000555455500000000001919900000000001111110c7c77cc0aa8a8aa8aa000000
000000000000000000000000000000000000000007777700000000000000000000000000000000000000000000000000118181110ccccc0000a8889aa0000000
000000000000000000bbbb0000bbbb0000bbbb00777777700000000000040300000000000000000000000000000000001e111e11076665500079997600700000
00bbbb0000bbbb000bbbebb00bbbebb00bbbebb07777777000000000008430000000000000000000000000000000000001111110766766550676676667000000
0bbbebb00bbbebb00b3efeb00b3efeb00b3efe70777777700000000008ff88000000000000000000000000000000000000100100076766650667676660000000
0b3efeb00b3efeb00bb3eb700773e7700773e7700777770000000000088888000000000000000000000000000000000001100110005076500060607600000000
0bb3ebb00bb3eb700b00070007000700070007000007700000000000088888000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000770000000000008480000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000010000000000006000000000
000000000000000000000000000000000000000000000000000000000000000000b0b00000000000000000000000000077700100100077700666660000000000
0000000000000000000000000000000000000000000000000000000000b0b00000bb000000000000000000000000000077779909900777700660000566000000
0000000000000000000000000000000000000000000000000000000000bb0000088880000000000000000000000000007777aa9aa97777707665505666000000
0000000000000000000000000000000000000000000000000000000008888000888888000000000000000000000000000777aa9aa98777007666666666000000
000000000000000000000000000000000000000000000000000000008888880080008800000000000000000000000000000099a9919900000076d66660000000
000000000000000000000000000000000000000000000000000000008a8a88300a0a80000000000000000000000000000000a1a1a1900000000d7d77dd000000
000000000000000000000000000000000000000000000000000000000aaaa3030aaaa33300000000000000000000000000000aaa99000000000707077d500000
0000000000000000000000000000000000000000000000000000000007800078000000000000000000000000000000000000100001000000066d7d77d6560000
00000000000000000000000000000000000000000000000000000000088700770000000000000000000000000000000000000100100000000766ddd665660000
00000000000000000000000000000000000000000000000000000000007808800000000000000000000000000000000000009909900000000066666766600000
0000000000000000000000000000000000000000000000000000000000007700000000000000000000000000000000000077aa9aa97770000007655776000000
00000000000000000000000000000000000000000000000000000000a0aaa000000000000000000000000000000000000777aa9aa98777000000066550000000
000000000000000000000000000000000000000000000000000000000aaaaaa000000000000000000000000000000000777799a9919777700000006600000000
000000000000000000000000000000000000000000000000000000000aaa0a00000000000000000000000000000000007770a1a1a19077700000000600000000
0000000000000000000000000000000000000000000000000000000000aaa0000000000000000000000000000000000000000aaa990000000000000000000000
33333333444444443333333344444444333333333333333300030000333bb3330000000000000000000000000000000000000000000000000000000000000000
4344434445444454443443344444444444444444443443340003a000443433340000000000000000000000000000000000000000000000000000000000000000
43444334444544444434434444444444444444440030430000330000000b90000000000000000000000000000000000000000000000000000000000000000000
43344434444444444444334445444444444444440000330000930000000030000000000000000000000000000000000000000000000000000000000000000000
4344443454455454444434444444445444444444000030000003b0000003b0000000000000000000000000000000000000000000000000000000000000000000
44444444444444544444444444444454445444440000000000033000000300000000000000000000000000000000000000000000000000000000000000000000
44445444445444444444444444444444444444440000000000b30000000930000000000000000000000000000000000000000000000000000000000000000000
44444444444544444454444444454444444444440000000000030000000330000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000100000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111100000000000000000
4444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ffff100000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100ff0010000000000000000
444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001effffe10000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111110000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003311fffffffffff111000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000311fffffffffffff11000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003311fffffffffffff11100000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003111fffffffffffff11100000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031111fffffffffff311100000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000311111fffffffff3111100000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000331111111ffffff31111110000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031111111111111111111110000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031111111111111111111110000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055fffff31111111111113fffff550
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005fffffffff11111111fffffffff50
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fffff44fff31111111fff44fffff0
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055fff4444fff311111fff4444fff55
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055ff444444ff311111ff444444ff55
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffff4444fff311111fff4444ffff0
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055ffff44fff00311100fff44ffff55
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000100010102030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000454745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000004600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4240444044404244404042004640404440424444424040424440444442424044000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4343434343434343434343444443434300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4343414341434343434343414143434100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4141414141414141414141414141414100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
